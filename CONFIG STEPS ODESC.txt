dev0.erase_configuration()

odrv0 = dev0

# CAN config
odrv0.can.config.baud_rate = 125000
odrv0.axis0.config.can.node_id = 0
odrv0.axis0.config.can.encoder_rate_ms = 200
odrv0.axis0.config.can.heartbeat_rate_ms = 200

odrv0.axis0.config.watchdog_timeout = 1
odrv0.axis0.config.enable_watchdog = True

# HW config
odrv0.config.brake_resistance = 2
odrv0.config.enable_brake_resistor = True

# HW PSU/battery config
odrv0.config.dc_max_positive_current = 25
odrv0.config.dc_max_negative_current = -2.0
odrv0.config.max_regen_current = 1.0
odrv0.config.dc_bus_undervoltage_trip_level = 12
odrv0.config.dc_bus_overvoltage_trip_level = 17
odrv0.config.dc_bus_overvoltage_ramp_start = 16
odrv0.config.dc_bus_overvoltage_ramp_end = 16.8

# IDK config
odrv0.axis0.controller.config.pos_gain = 20
odrv0.axis0.controller.config.vel_gain = 0.02
odrv0.axis0.controller.config.vel_integrator_gain = 0.02

# Controller behavior config
odrv0.axis0.controller.config.control_mode = CONTROL_MODE_VELOCITY_CONTROL
odrv0.axis0.controller.config.input_mode = INPUT_MODE_VEL_RAMP
odrv0.axis0.controller.config.vel_ramp_rate = 50
odrv0.axis0.controller.config.vel_limit = 100 # theoretically this is 100*60 = 6000 RPM
TODO TEST THIS LIMIT ONCE MOTOR WILL WORK FROM RC

odrv0.axis0.sensorless_estimator.config.pm_flux_linkage = 5.51328895422 / (7 * 290)
odrv0.axis0.motor.config.pole_pairs = 7
odrv0.axis0.motor.config.current_lim = 20 # engine phase currents
TODO TEST THIS OR SOMETHING INCREASE TO BIGGER VALUE?
odrv0.axis0.motor.config.calibration_current = 8
odrv0.axis0.motor.config.requested_current_range = 40 # Lets set it bigger than current lim idk

# Actual calibration of the motor (moved to the end)
#odrv0.axis0.requested_state = AXIS_STATE_MOTOR_CALIBRATION
#odrv0.axis0.motor.config.pre_calibrated = True

# TUNING LOCKIN RAMP 
odrv0.axis0.sensorless_estimator.config.observer_gain = 1500
odrv0.axis0.sensorless_estimator.config.pll_bandwidth = 1500
odrv0.axis0.config.enable_sensorless_mode = True
odrv0.axis0.config.sensorless_ramp.current = 10
odrv0.axis0.config.sensorless_ramp.vel = -150 # zeby zwykle zaczynal w dobrym kierunku xd
odrv0.axis0.config.sensorless_ramp.ramp_time = 0
odrv0.axis0.config.sensorless_ramp.accel = 500

# Actual calibration of the motor
odrv0.axis0.requested_state = AXIS_STATE_MOTOR_CALIBRATION
odrv0.axis0.motor.config.pre_calibrated = True
odrv0.save_configuration()




